# –°–∏—Å—Ç–µ–º–∞ –º–∞—Å—Å–æ–≤—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫

## –û–±–∑–æ—Ä

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–∞—Å—Å–æ–≤—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫ —Å —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤.

## –î–æ—Å—Ç—É–ø

–°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ **—Ç–æ–ª—å–∫–æ –¥–ª—è super_admin** —á–µ—Ä–µ–∑:
- –ú–µ–Ω—é —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ‚Üí "üì¢ –†–∞—Å—Å—ã–ª–∫–∞"
- Callback: `superadmin:broadcast`

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–∏

**–ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è (5 —à–∞–≥–æ–≤):**

1. **–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è**
   - –ú–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤, –º–∞–∫—Å–∏–º—É–º 4096
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ HTML —Ä–∞–∑–º–µ—Ç–∫–∏:
     - `<b>–∂–∏—Ä–Ω—ã–π</b>`
     - `<i>–∫—É—Ä—Å–∏–≤</i>`
     - `<code>–º–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π</code>`
     - `<a href='url'>—Å—Å—ã–ª–∫–∞</a>`

2. **–ú–µ–¥–∏–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**
   - –§–æ—Ç–æ
   - –í–∏–¥–µ–æ
   - –î–æ–∫—É–º–µ–Ω—Ç
   - –ú–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏

3. **–í—ã–±–æ—Ä –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π**
   - –§–∏–ª—å—Ç—Ä—ã –º–æ–∂–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å (–∫—Ä–æ–º–µ "–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏")
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

4. **–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—Å—Ç–∞
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
   - –¢–∏–ø —Ä–∞—Å—Å—ã–ª–∫–∏
   - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã

5. **–û—Ç–ø—Ä–∞–≤–∫–∞**
   - –§–∏–Ω–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
   - –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### 2. –§–∏–ª—å—Ç—Ä—ã —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏

| –§–∏–ª—å—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|--------|----------|--------|
| **–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** | –ë–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ | –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ |
| **–ê–∫—Ç–∏–≤–Ω—ã–µ (30 –¥–Ω–µ–π)** | –ü–∏—Å–∞–ª–∏ –±–æ—Ç—É –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π | –ù–µ–¥–∞–≤–Ω–æ –∞–∫—Ç–∏–≤–Ω—ã–µ |
| **–ï—Å—Ç—å –∑–∞–∫–∞–∑—ã** | –°–¥–µ–ª–∞–ª–∏ —Ö–æ—Ç—è –±—ã 1 –∑–∞–∫–∞–∑ | –ö–ª–∏–µ–Ω—Ç—ã |
| **–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤** | –ï—â–µ –Ω–µ –∑–∞–∫–∞–∑—ã–≤–∞–ª–∏ | –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã |
| **–ú–∏–Ω–∏–º—É–º 3 –∑–∞–∫–∞–∑–∞** | –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã | VIP –∫–ª–∏–µ–Ω—Ç—ã |

**–ü—Ä–∞–≤–∏–ª–∞ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:**
- "–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏" –æ—Ç–∫–ª—é—á–∞–µ—Ç –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
- "–ï—Å—Ç—å –∑–∞–∫–∞–∑—ã" –∏ "–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤" –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ
- –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –º–æ–∂–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å

**–ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–±–∏–Ω–∞—Ü–∏–π:**
```
–ê–∫—Ç–∏–≤–Ω—ã–µ + –ï—Å—Ç—å –∑–∞–∫–∞–∑—ã = –ù–µ–¥–∞–≤–Ω–∏–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª–∏
–ê–∫—Ç–∏–≤–Ω—ã–µ + –ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ = –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã
–ú–∏–Ω–∏–º—É–º 3 –∑–∞–∫–∞–∑–∞ = –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã
```

### 3. –ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—Å—ã–ª–æ–∫

**–°—Ç–∞—Ç—É—Å—ã —Ä–∞—Å—Å—ã–ª–æ–∫:**
- ‚è≥ **Pending** - –û–∂–∏–¥–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏
- ‚ñ∂Ô∏è **In Progress** - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
- ‚úÖ **Completed** - –ó–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
- ‚ùå **Failed** - –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
- üö´ **Cancelled** - –û—Ç–º–µ–Ω–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º

**–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:**
- –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- –¢–∏–ø (—Ç–µ–∫—Å—Ç / —Ç–µ–∫—Å—Ç + –º–µ–¥–∏–∞)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
- –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
- –ü—Ä–µ–≤—å—é —Ç–µ–∫—Å—Ç–∞ (–ø–µ—Ä–≤—ã–µ 200 —Å–∏–º–≤–æ–ª–æ–≤)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
- üîÑ **–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É** (–¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö)
- üö´ **–û—Ç–º–µ–Ω–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É** (–¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö)

### 4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–∞—Å—Å—ã–ª–∫–∞–º:**
- –í—Å–µ–≥–æ —Ä–∞—Å—Å—ã–ª–æ–∫
- –ü–æ —Å—Ç–∞—Ç—É—Å–∞–º (–æ–∂–∏–¥–∞—é—Ç, –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ, –∑–∞–≤–µ—Ä—à–µ–Ω—ã, –æ—à–∏–±–∫–∏, –æ—Ç–º–µ–Ω–µ–Ω—ã)
- –í—Å–µ–≥–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π
- –£—Å–ø–µ—à–Ω–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ
- –û—à–∏–±–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
- –û–±—â–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Rate Limiting

–°–∏—Å—Ç–µ–º–∞ —Å–æ–±–ª—é–¥–∞–µ—Ç –ª–∏–º–∏—Ç—ã Telegram API:
- **20 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É** (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ª–∏–º–∏—Ç)
- **–†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞**: 20 —Å–æ–æ–±—â–µ–Ω–∏–π
- **–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏**: 1 —Å–µ–∫—É–Ω–¥–∞

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –æ—à–∏–±–∫–∏:

1. **TelegramForbiddenError** (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞)
   - –ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–∞—Å—Å—ã–ª–∫—É
   - –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ –±–∞–∑—É
   - –ó–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ failed

2. **TelegramBadRequest** (–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å)
   - –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å –¥–µ—Ç–∞–ª—è–º–∏
   - –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞—Å—Å—ã–ª–∫—É

3. **TelegramRetryAfter** (–ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞
   - –û–∂–∏–¥–∞–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

### –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä

–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤–∏–¥–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –æ—Ç–ø—Ä–∞–≤–∫–∏:
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 100 —Å–æ–æ–±—â–µ–Ω–∏–π
- –¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å (N/M)
- –ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫

–ü—Ä–∏–º–µ—Ä:
```
üì§ –†–∞—Å—Å—ã–ª–∫–∞ #42

–ü–æ–ª—É—á–∞—Ç–µ–ª–µ–π: 1500
–ü—Ä–æ–≥—Ä–µ—Å—Å: 750/1500 (50%)

‚úÖ –£—Å–ø–µ—à–Ω–æ: 735
‚ùå –û—à–∏–±–∫–∏: 15
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–ú–æ–¥–µ–ª—å Broadcast:**
```python
id: int                          # ID —Ä–∞—Å—Å—ã–ª–∫–∏
text: str                        # –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
media_type: str | None           # photo, video, document
media_file_id: str | None        # Telegram file_id
buttons: dict | None             # Inline –∫–Ω–æ–ø–∫–∏ (–±—É–¥—É—â–µ–µ)
status: str                      # pending, in_progress, completed, failed, cancelled
filters: dict | None             # –§–∏–ª—å—Ç—Ä—ã —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
total_target: int                # –í—Å–µ–≥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
sent_count: int                  # –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
success_count: int               # –£—Å–ø–µ—à–Ω–æ
failed_count: int                # –û—à–∏–±–∫–∏
error_log: dict | None           # –õ–æ–≥–∏ –æ—à–∏–±–æ–∫
created_by: int                  # ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
created_at: datetime             # –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
completed_at: datetime | None    # –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
```

**Properties:**
- `has_filters: bool` - –ï—Å—Ç—å –ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã
- `is_sent: bool` - –ë—ã–ª–∞ –ª–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞
- `is_completed: bool` - –ó–∞–≤–µ—Ä—à–µ–Ω–∞ –ª–∏
- `has_media: bool` - –ï—Å—Ç—å –ª–∏ –º–µ–¥–∏–∞
- `success_rate: float` - –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ê–∫—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```
–¢–µ–∫—Å—Ç: "üéâ –°–∫–∏–¥–∫–∞ 20% –Ω–∞ –≤—Å—ë! –¢–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è!"
–ú–µ–¥–∏–∞: –ë–∞–Ω–Ω–µ—Ä –∞–∫—Ü–∏–∏ (—Ñ–æ—Ç–æ)
–§–∏–ª—å—Ç—Ä: –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
```

### –ü—Ä–∏–º–µ—Ä 2: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º
```
–¢–µ–∫—Å—Ç: "üëã –ó–∞–º–µ—Ç–∏–ª–∏ —á—Ç–æ-—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ? –û—Ñ–æ—Ä–º–∏—Ç–µ –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑!"
–ú–µ–¥–∏–∞: –ù–µ—Ç
–§–∏–ª—å—Ç—Ä—ã: –ê–∫—Ç–∏–≤–Ω—ã–µ (30 –¥–Ω–µ–π) + –ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤
```

### –ü—Ä–∏–º–µ—Ä 3: VIP –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
```
–¢–µ–∫—Å—Ç: "üíé –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –≤–∞—Å - —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è"
–ú–µ–¥–∏–∞: –ö–∞—Ç–∞–ª–æ–≥ (–¥–æ–∫—É–º–µ–Ω—Ç PDF)
–§–∏–ª—å—Ç—Ä: –ú–∏–Ω–∏–º—É–º 3 –∑–∞–∫–∞–∑–∞
```

### –ü—Ä–∏–º–µ—Ä 4: –†–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤
```
–¢–µ–∫—Å—Ç: "–ú—ã —Å–∫—É—á–∞–µ–º! –í–µ—Ä–Ω–∏—Ç–µ—Å—å –∏ –ø–æ–ª—É—á–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫ üéÅ"
–ú–µ–¥–∏–∞: –ù–µ—Ç
–§–∏–ª—å—Ç—Ä—ã: –ï—Å—Ç—å –∑–∞–∫–∞–∑—ã (–Ω–æ –Ω–µ –ê–∫—Ç–∏–≤–Ω—ã–µ)
```

## –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–î–ª—è production –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é:

```sql
-- –ò–∑ —Ñ–∞–π–ª–∞: migrations/001_update_broadcasts_table.sql
psql -U postgres -d odezhdabot -f migrations/001_update_broadcasts_table.sql
```

–ò–ª–∏ —á–µ—Ä–µ–∑ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
```bash
docker exec -i postgres_container psql -U user -d dbname < migrations/001_update_broadcasts_table.sql
```

## API —Å–µ—Ä–≤–∏—Å–æ–≤

### BroadcastService

```python
from src.services.broadcast_service import BroadcastService

service = BroadcastService(session)

# –°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É
broadcast = await service.create_broadcast(
    text="–¢–µ–∫—Å—Ç",
    admin_id=123,
    filters={"all": True},
    media_type="photo",
    media_file_id="AgACAgI...",
)

# –ü–æ–ª—É—á–∏—Ç—å —Ü–µ–ª–µ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
users = await service.get_target_users({
    "active_days": 30,
    "has_orders": True,
})

# –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
await service.increment_broadcast_stats(
    broadcast_id=1,
    sent=1,
    success=1,
)

# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
stats = await service.get_broadcast_stats()
```

### BroadcastSender

```python
from src.utils.broadcast_sender import BroadcastSender

sender = BroadcastSender(bot, session, broadcast_id)

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É
stats = await sender.send_broadcast(
    admin_telegram_id=12345,  # –î–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
)

# –û—Ç–º–µ–Ω–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É
sender.cancel()
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–î–æ—Å—Ç—É–ø**: –¢–æ–ª—å–∫–æ IsSuperAdmin —Ñ–∏–ª—å—Ç—Ä
2. **Rate Limiting**: –°–æ–±–ª—é–¥–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ Telegram
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—Å—Ç–∞, —Ñ–∏–ª—å—Ç—Ä–æ–≤, —Ñ–∞–π–ª–æ–≤
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
5. **Error Handling**: Graceful degradation –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: ~50 —Å–µ–∫—É–Ω–¥ (20 msg/sec)
- **5000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: ~4 –º–∏–Ω—É—Ç—ã
- **10000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: ~8 –º–∏–Ω—É—Ç

–í—Ä–µ–º—è –≤–∫–ª—é—á–∞–µ—Ç:
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –ë–î
- –û—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

## Roadmap (–±—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è)

- [ ] –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–æ–∫ (–æ—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞)
- [ ] Inline –∫–Ω–æ–ø–∫–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–æ–∫
- [ ] –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (–æ—Ç–∫—Ä—ã—Ç–∏—è, –∫–ª–∏–∫–∏)
- [ ] –®–∞–±–ª–æ–Ω—ã —Ä–∞—Å—Å—ã–ª–æ–∫
- [ ] –≠–∫—Å–ø–æ—Ä—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ CSV/Excel
- [ ] Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
